define("wiki-common:widget/component/userbar-n/userbar-n.js",function(e,a,s){var n=e("wiki-common:widget/lib/jquery/jquery.js"),t=e("wiki-common:widget/component/userLogin/userLogin.js"),i=e("wiki-common:widget/component/userMsg/userMsg.js"),r=e("wiki-common:widget/lib/jsmart/jsmart.js"),l=e("wiki-common:widget/util/browser.js"),o=e("wiki-common:widget/ui/bubble/bubble.js"),m={userbar:{unlogin:new r('<li>\n<a href="http://www.baidu.com/" nslog="normal" nslog-type="10080109" >百度首页</a>\n</li>\n<li>\n<a data-action=\'login\' href="javascript:;" nslog="normal" nslog-type="10080110" >登录</a>\n</li>\n<li>\n<a href="https://passport.baidu.com/v2/?reg&regType=1&tpl=wk" nslog="normal" nslog-type="10080111" >注册<a>\n</li>'),login:new r('<li>\n<a href="http://www.baidu.com/" nslog="normal" nslog-type="10080112" >百度首页</a>\n</li>\n<li class="userbar_user" data-action="showUserMenu">\n<a href="javascript:;" nslog="normal" nslog-type="10080113" ><span>{%$displayName|escape:html|escape:none%}</span><i class="icon-triangle-down"></i></a>\n</li>\n<li class="userbar_message" data-action="showUserMsg">\n<a href="javascript:;" nslog="normal" nslog-type="10080115" >消息<span class="userbar_message_new_num"></span><i class="icon-triangle-down"></i></a>\n</li>\n<li class="userbar_mall">\n<a href="/mall/" target="_blank" nslog="normal" nslog-type="10080114" >商城</a>\n</li>\n{%if $UIConfig.btns|hasElement:"settings"%}\n<li class="userbar_setting">\n<a href="/usercenter/settings" nslog="normal" nslog-type="10080116" target="_blank"><em class="cmn-icon cmn-icons cmn-icons_cog"></em>设置</a>\n</li>\n{%/if%}')},menu:{userMenu:new r('<ul>\n<li class="top"><a href="/usercenter" target="_blank">我的百科</a></li>\n<li><a href="/usercenter/tasks#mine" target="_blank">我的任务</a></li>\n<li><a href="/usercenter/lemmas" target="_blank">我的词条</a></li>\n{%if $isAuthLemma%}\n<li><a href="/member/mylemmas" target="_blank">我的订单</a></li>\n{%/if%}\n<li><a href="https://passport.baidu.com/center" target="_blank">账号设置</a></li>\n<li class="bottom logout"><a data-action="logout" href="javascript:;">退出</a></li>\n</ul>'),userMsg:new r('<ul>\n<li class="top"><a href="/messages" target="_blank"><span class="userMsgType">通知</span>{%if $baikeMsg.notice && $baikeMsg.notice.num > 0%}<span class="userMsgCount">{%if $baikeMsg.notice.num < 100%}{%$baikeMsg.notice.num|f_escape_xml%}{%else%}99{%/if%}</span>{%/if%}</a></li><li class="bottom"><a href="https://gsp0.baidu.com/8_UFsjip0QIZ8tyhnq/" target="_blank"><span class="userMsgType">私信</span>{%if $baiduMsg.msgnum > 0%}<span class="userMsgCount">{%if $baiduMsg.msgnum < 100%}{%$baiduMsg.msgnum|f_escape_xml%}{%else%}99+{%/if%}</span>{%/if%}</a></li>\n</ul>')},bubble:{lemmaMsg:new r('<ul>\n{%foreach $baikeMsg as $idx => $msg%}\n{%if $idx === "passedVersion" && $msg.num > 0%}\n<li><a href="/usercenter/lemmas#passed" data-action="readMessage" data-msgType="3" target="_blank">您有{%$msg.num|f_escape_xml%}个版本已通过</a></li>\n{%else if $idx === "failedVersion" && $msg.num > 0%}\n<li><a href="/usercenter/lemmas#rejected" data-action="readMessage" data-msgType="4" target="_blank">您有{%$msg.num|f_escape_xml%}个版本未通过</a></li>\n{%else if $idx === "deletedVersion" && $msg.num > 0%}\n<li><a href="/usercenter/lemmas#rejected" data-action="readMessage" data-msgType="6" target="_blank">您有{%$msg.num|f_escape_xml%}个版本被删除</a></li>\n{%else if $idx === "goodVersion" && $msg.num > 0%}\n<li><a href="/usercenter/lemmas#passed-good" data-action="readMessage" data-msgType="7" target="_blank">您有{%$msg.num|f_escape_xml%}个版本被评为优质版本</a></li>\n{%else if $idx === "featuredLemma" && $msg.num > 0%}\n<li><a href="/usercenter/lemmas#passed-featured" data-action="readMessage" data-msgType="8" target="_blank">您有{%$msg.num|f_escape_xml%}个词条被评为特色词条</a></li>\n{%else if $idx === "deletedLemma" && $msg.num > 0%}\n<li><a href="/usercenter/lemmas#rejected" data-action="readMessage" data-msgType="5" target="_blank">您有{%$msg.num|f_escape_xml%}个词条被删除</a></li>\n{%else if $idx === "featuredModified" && $msg.num > 0%}\n<li><a href="/usercenter/lemmas#passed-featured" data-action="readMessage" data-msgType="9" target="_blank">您有{%$msg.num|f_escape_xml%}个特色词条被修改</a></li>\n{%else if $idx === "tousu" && $msg.num > 0%}\n<li><a href="/messages" data-action="readMessage" data-msgType="2" target="_blank">您有{%$msg.num|f_escape_xml%}个投诉处理消息</a></li>\n{%else if $idx === "passedPersonalVersion" && $msg.num > 0%}\n<li><a href="/usercenter/personal" data-action="readMessage" data-msgType="10" target="_blank">您的实名词条有1个版本已通过</a></li>\n{%else if $idx === "failedPersonalVersion" && $msg.num > 0%}\n<li><a href="/usercenter/personal" data-action="readMessage" data-msgType="11" target="_blank">您的实名词条有1个版本未通过</a></li>\n{%else if $idx === "deletedPersonalVersion" && $msg.num > 0%}\n<li><a href="/usercenter/personal" data-action="readMessage" data-msgType="12" target="_blank">您的实名词条有1个版本被删除</a></li>\n{%else if $idx === "second" && $msg.num > 0%}\n<li><a href="/messages" data-action="readMessage" data-msgType="13" target="_blank">您有{%$msg.num|f_escape_xml%}个秒懂消息</a></li>\n{%/if%}\n{%/foreach%}\n<li class="cancelAlarm"><a href="/usercenter/settings#message" target="_blank">不再接收此类消息</a></li>\n</ul>\n<a class="wgt-bubble-lemmaMsg_close" data-action="cancelAlarm" href="javascript:;"><em class="cmn-icon cmn-icons cmn-icons_close"></em></a>')}};r.prototype.registerPlugin("modifier","hasElement",function(e,a){for(var s in e)if(e[s]==a)return!0;return!1});var u={render:{userbar:function(e,a,s){switch(a){case"unlogin":e.html(m.userbar[a].fetch(s));break;case"login":e.html(m.userbar[a].fetch(s))}},menu:function(e,a,s,i){var r=new o({host:a,content:m.menu[s].fetch(i),pos:"bottom-center",marginFromHost:4,offset:{top:7},showTail:"undefined"==typeof l.ie()||l.ie()>9?!0:!1,classNames:"wgt-bubble-"+s}),u=n(r.getNode());return a.mouseover(function(){var s=this;"showUserMenu"==n(s).attr("data-action")&&e.find(".userbar_user").addClass("spreadUserMenu"),r.show(function(){var t="";a.on("mouseleave",function(){t=setTimeout(function(){"showUserMenu"==n(s).attr("data-action")&&e.find(".userbar_user").removeClass("spreadUserMenu"),r.hide()},100)}),u.on("mouseenter",function(){clearTimeout(t),u.on("mouseleave",function(){"showUserMenu"==n(s).attr("data-action")&&e.find(".userbar_user").removeClass("spreadUserMenu"),r.hide()})})})}),u.on("click","a",function(){var e=n(this).attr("data-action");if(e){switch(e){case"logout":t.logout()}return!1}}),u},bubble:function(e,a,s){var t=new o({host:e,content:m.bubble[a].fetch(s),pos:"bottom-center",showTail:"undefined"==typeof l.ie()||l.ie()>9?!0:!1,hideWhenBlur:!1,classNames:"wgt-bubble-"+a,marginFromHost:4,offset:{top:7,left:-80}}),i=n(t.getNode());return t.show(),i}}},c={buildUserbar:function(e,a){var a="object"==typeof a&&a instanceof Array?a:[];t.checkIfLogin({ifMsg:!0,onUnlogin:function(){u.render.userbar(e,"unlogin")},onLogin:function(s){u.render.userbar(e,"login",n.extend(s,{UIConfig:{btns:a}})),u.render.menu(e,e.find('li[data-action="showUserMenu"]'),"userMenu",{isAuthLemma:s.isAuthLemma}),i.getUserMsg({userInfo:s,getBaikeMsg:!1},function(a){var t={baiduMsg:a,baikeMsg:s.msgStatus},i=t.baiduMsg.msgnum+t.baikeMsg.notice.num;i>0&&e.find(".userbar_message .userbar_message_new_num").html("("+i+")"),u.render.menu(e,e.find('li[data-action="showUserMsg"]'),"userMsg",t);var r=0;for(var l in t.baikeMsg)"notice"!==l&&(r+=t.baikeMsg[l].num);if(r>0){var o=u.render.bubble(e.find('li[data-action="showUserMenu"]'),"lemmaMsg",t);o.on("click","a",function(){var e=n(this).attr("data-action");switch(e){case"readMessage":var a=n(this).attr("data-msgType");break;case"cancelAlarm":var a="all"}return n.ajax({type:"GET",url:"/api/wikimessage/readmsgstatus",data:{type:a},dataType:"JSON",complete:function(){o.remove()}}),"cancelAlarm"===e?!1:void 0})}})}}),e.on("click","a",function(){var e=n(this).attr("data-action");if(e){switch(e){case"login":t.showLoginPop()}return!1}})}};s.exports=c});